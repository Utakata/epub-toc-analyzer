# 📚 EPUB Word目次レベル3段階出力ツール

日本の書籍に最適化された、EPUBファイルの目次構造を詳細に分析し、Word形式で出力するツールです。

## 🌟 主な機能

- **3段階目次レベル解析**: 目次レベル1（大見出し）、レベル2（中見出し）、レベル3（小見出し）に分けて出力
- **Word文書出力**: `.docx`形式での詳細な分析レポート生成
- **テキスト出力**: プレーンテキストでの分析結果出力
- **日本語最適化**: 日本語書籍の章構造に特化した処理
- **階層関係表示**: 各見出しの親子関係を明確に表示
- **バッチ処理**: 複数ファイルの一括処理（新機能）
- **GUI改善**: 使いやすいドラッグ&ドロップインターフェース

## 📋 システム要件

- Python 3.6以上
- Windows/macOS/Linux対応

## 🚀 セットアップ

### 1. ライブラリのインストール

```bash
pip install -r requirements.txt
```

または、個別にインストール：

```bash
pip install beautifulsoup4 lxml six python-docx defusedxml jaconv
```

### 2. ファイルの準備

`epubsplit_word_toc.py`をダウンロードして、適当な場所に配置してください。

## 💡 使用方法

### 🖥️ GUI版（推奨・初心者向け）

**最も簡単な方法:**

1. **Windowsの場合**: `launch_gui.bat` をダブルクリック
2. **その他のOS**: `python epub_toc_gui.py` をターミナルで実行

```bash
# GUI版を起動
python epub_toc_gui.py

# または簡単ランチャーを使用
python launcher.py
```

**GUI版の特徴:**
- 📁 ドラッグ&ドロップでファイル選択
- 🔍 リアルタイムプログレス表示
- 👁️ 簡易プレビュー機能
- 📊 結果の即座確認
- ❓ 内蔵ヘルプ機能
- 🔄 バッチ処理対応（複数ファイル一括処理）

### 📟 コマンドライン版（上級者向け）

```bash
python epubsplit_word_toc.py sample.epub
```

### オプション付きの使用方法

```bash
# 出力ディレクトリを指定
python epubsplit_word_toc.py -o ./output sample.epub

# テキスト形式のみ出力
python epubsplit_word_toc.py -f text sample.epub

# Word文書のみ出力
python epubsplit_word_toc.py -f word sample.epub

# 両方出力（デフォルト）
python epubsplit_word_toc.py -f both sample.epub

# バッチ処理（複数ファイル）
python epubsplit_word_toc.py -b /path/to/epub/folder
```

### コマンドラインオプション

| オプション | 説明 | デフォルト |
|------------|------|------------|
| `-o, --output-dir` | 出力ディレクトリを指定 | 現在のディレクトリ |
| `-f, --format` | 出力形式 (text/word/both) | both |
| `-b, --batch` | バッチ処理モード | False |
| `-h, --help` | ヘルプを表示 | - |

## 📊 出力ファイル

### テキスト形式出力 (.txt)

```
================================================================================
📚 書籍目次構造分析レポート
書籍名: サンプル書籍
著者: 山田太郎
生成日時: 2025年06月10日 15:30:00
================================================================================

📖 目次レベル1（大見出し）
------------------------------------------------------------
 1. 第1章　序論
     ファイル: chapter01.html
 2. 第2章　基礎知識
     ファイル: chapter02.html

📝 目次レベル2（中見出し）
------------------------------------------------------------
 1. 1.1 背景
     └ 親レベル1: 第1章　序論
     ファイル: chapter01.html
     アンカー: #section1-1

📊 目次統計
------------------------------------------------------------
レベル1エントリ数: 5
レベル2エントリ数: 12
レベル3エントリ数: 8
総エントリ数: 25
```

### Word文書出力 (.docx)

- 書籍情報（タイトル、著者、生成日時）
- 目次レベル1〜3の詳細リスト
- 階層関係の表示
- 統計情報
- 見やすいフォーマット

## 🔧 改善点・新機能

### v2.0 新機能

- **Calibre互換**: CalibreのXPath式ベースTOC検出手法を参考
- **エラー処理強化**: 不正なEPUBファイルへの対応改善
- **処理速度向上**: 大容量ファイルの高速処理
- **バッチ処理**: フォルダ内の全EPUBファイルを一括処理
- **GUI改善**: より直感的なユーザーインターフェース

### Calibreベースの改善

- **XPath式による階層検出**: `//h:h1`, `//h:h2`, `//h:h3` パターン
- **ヒューリスティック処理**: 未フォーマット見出しの自動検出
- **デバッグモード**: 中間XHTML出力での検証機能

## 🔧 トラブルシューティング

### python-docxがインストールできない場合

```bash
# アップデートしてから再試行
pip install --upgrade pip setuptools wheel
pip install python-docx
```

### 文字化けが発生する場合

- EPUBファイルのエンコーディングを確認してください
- ファイル名に日本語が含まれている場合は英数字に変更してみてください

### メモリエラーが発生する場合

非常に大きなEPUBファイルの場合、メモリ不足になる可能性があります：

```bash
# メモリ使用量を制限して実行
python -X dev epubsplit_word_toc.py sample.epub
```

## 📞 サポート

### よくある質問

**Q: EPUBファイルに目次がない場合はどうなりますか？**
A: Calibre互換のヒューリスティック処理により、ファイル構造から推測して基本的な分析を行います。

**Q: 大きなファイルの処理時間はどのくらいですか？**
A: v2.0で処理速度が向上。一般的な書籍（数MB）であれば数秒で処理できます。

**Q: バッチ処理でどれくらいのファイルを処理できますか？**
A: システムのメモリに依存しますが、数百ファイルまで対応可能です。

## 📄 ライセンス

GPL v3ライセンスの下で公開されています。

## 🙏 謝辞

- Calibreプロジェクト（TOC検出手法の参考）
- オリジナルのEpubSplitプロジェクト
- BeautifulSoup、python-docx等のライブラリ開発者の皆様

---

*最終更新: 2025年6月23日*
